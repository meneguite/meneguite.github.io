<!DOCTYPE html>
<html  lang="pt">
<head>
    <meta charset="utf-8">
<title>Publicando uma aplicação NodeJs na Digital Ocean - Ronaldo Meneguite</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />



    <meta name="description" content="Enfim, depois de todo esforço para desenvolver aquela aplicação, chegou a hora de subir ela em produção. Escolher onde e como disponibilizar essa solução para seus clientes em potencial pode ser deter">
<meta property="og:type" content="article">
<meta property="og:title" content="Publicando uma aplicação NodeJs na Digital Ocean">
<meta property="og:url" content="https://meneguite.com/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/index.html">
<meta property="og:site_name" content="Ronaldo Meneguite">
<meta property="og:description" content="Enfim, depois de todo esforço para desenvolver aquela aplicação, chegou a hora de subir ela em produção. Escolher onde e como disponibilizar essa solução para seus clientes em potencial pode ser deter">
<meta property="og:locale" content="pt_BR">
<meta property="og:image" content="https://meneguite.com/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/001.jpg?v=2">
<meta property="article:published_time" content="2021-07-13T18:00:00.000Z">
<meta property="article:modified_time" content="2021-07-14T14:42:27.915Z">
<meta property="article:author" content="Ronaldo Meneguite">
<meta property="article:tag" content="Backend">
<meta property="article:tag" content="Cloudflare">
<meta property="article:tag" content="Node">
<meta property="article:tag" content="Digital Ocean">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://meneguite.com/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/001.jpg?v=2">
<meta property="fb:admins" content="ronaldomeneguite">
<meta property="fb:app_id" content="284008812234350">





<link rel="icon" href="/images/favicon.svg">


<!--
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
-->

<link rel="stylesheet" href="/css/bulma.css">


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro.css">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


<link rel="stylesheet" href="/css/style.css">



    
    
    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">

    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    

    
    
    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    

    
    
    
    <style>body>.navbar,body>.section,body>.footer{opacity: 0}</style>
    

    
    
    
    


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-129084799-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-129084799-1');
</script>


    
    

<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

<style>
.pace {
  -webkit-pointer-events: none;
  pointer-events: none;

  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}

.pace-inactive {
  display: none;
}

.pace .pace-progress {
  background: #3273dc;
  position: fixed;
  z-index: 2000;
  top: 0;
  right: 100%;
  width: 100%;
  height: 2px;
}
</style>

    


<meta name="generator" content="Hexo 5.4.0"></head>
<body class="is-2-column ">
    <nav class="navbar navbar-main">
    <div class="container is-fluid">
        <!--<div class="navbar-brand is-flex-center">-->
            <!--<a class="navbar-item navbar-logo" href="/">-->
            <!---->
                <!--<img src="/images/logo.svg" alt="" height="28">-->
            <!---->
            <!--</a>-->
        <!--</div>-->
        <div class="navbar-menu alignright">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/categories">Categorias</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/archives">Histórico</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="Pesquisar" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section ">
        <div class="container is-fluid">
            <div class="columns">
                <div class="column is-8-tablet is-9-desktop is-9-widescreen has-order-2 column-main is-fullwidth"><div class="card">
    <div class="card-content article ">

        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Publicando uma aplicação NodeJs na Digital Ocean
            
        </h1>
        
            <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
                <div class="level-left">
                    <time class="level-item has-text-grey" datetime="2021-07-13T18:00:00.000Z">13/07/2021</time>
                    
                        <div class="level-item">
                            <a class="has-link-grey -link" href="/categories/Infraestrutura/">Infraestrutura</a>
                        </div>
                    
                    
                    <span class="level-item has-text-grey">
                    
                    
                    [ Ronaldo Meneguite ]
                    <!--27 minutos read (About 4072 words)-->
                    </span>
                    
                </div>
            </div>
        
        
          <div class="card-image">
             <span  class="image">
             <img class="thumbnail" src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/001.jpg?v=2" alt="Publicando uma aplicação NodeJs na Digital Ocean" />
             </span>
          </div>
        
        <div class="content">
            <html><head></head><body><p>Enfim, depois de todo esforço para desenvolver aquela aplicação, chegou a hora de subir ela em produção. Escolher onde e como disponibilizar essa solução para seus clientes em potencial pode ser determinante para o sucesso do projeto. Com isso em mente, temos ótimas soluções no mercado, entre as principais estão: Amazon AWS, Google Cloud, Microsoft Azure, e&nbsp;a que será foco desse artigo, Digital Ocean. Cada um destes provedores de serviço tem características bem peculiares que podem ou não aderir ao objetivo do projeto, não estando no escopo do artigo discorrer sobre as características de cada uma, porém é importante destacar que a Digital Ocean atende bem a muitos cenários, em especial aqueles que não possuem um grande fluxo de caixa inicial e precisam ter mais controle sobre o custo total de infraestrutura com um valor mais previsível, isso acontece pois lá é possível iniciar pequenas máquinas virtuais, denominadas “droplets” com um custo mensal a partir de US $ 5.00 por mês, na data que escrevo o artigo, com 1GB de memória, 1vCPU, 25 GB de SSD e 1TB de transferência, um valor bem razoável para o que entrega.</p>
<span id="more"></span>

<p>Como exemplo, a aplicação que iremos utilizar no artigo é uma api muito simplificada disponível em <a target="_blank" rel="noopener" href="https://github.com/meneguite/node-simple-api">https://github.com/meneguite/node-simple-api</a>, que nos possibilita descrever com mais facilidade uma forma de levar uma aplicação a produção, usando para isso além do node e npm, o nginx como proxy reverso e o pm2 como supervisor de instancia da aplicação.</p>
<h2 id="Configuracao-do-Droplet"><a href="#Configuracao-do-Droplet" class="headerlink" title="Configuração do Droplet"></a>Configuração do Droplet</h2><p>Para iniciarmos é necessário uma conta na Digital Ocean, caso ainda não tenha uma, crie a por esse link <a target="_blank" rel="noopener" href="https://m.do.co/c/2e1c3d77e32b">https://m.do.co/c/2e1c3d77e32b</a>, o cadastro é muito simplificado, e seguindo o link irá receber US $100 de bônus, o que possibilitara testar completamente a solução proposta por este artigo.</p>
<p>Com a conta criada vamos criar nosso primeiro droplet:</p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/002.jpg" class="">

<p>Selecionaremos o plano que melhor se enquadra na nossa necessidade: </p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/003.jpg" class="square">

<p>É possível incluir novos blocos de storage ao droplet, extendendo a capacidade de armazenamento base do plano, porém para esse exemplo não será necessário.</p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/004.jpg" class="">

<p>Selecionar a região do datacenter:</p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/005.jpg" class="square">

<p>Selecionar o método de autenticação:</p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/006.jpg" class="square">

<p>Para a autenticação recomendo fortemente que crie uma chave ssh, se já não possuir uma, isso será um bom incremento de segurança em sua instancia. </p>
<p>É possível também, quando necessário, anexar ao droplet um agendamento automático de backup.</p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/007.jpg" class="">

<p>Tudo correndo bem, visualizará uma tela semelhante a demonstrada abaixo, com nome da instancia e o ip externo atribuído a mesma:</p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/008.jpg" class="">

<p>Para acessar nossa instancia podemos utilizar o comando:</p>
<figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh root@161.35.10.18 </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Onde 161.35.10.18 é o ip externo disponibilizado pelo Digital Ocean</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="Instalando-e-Configurando-as-dependencias-para-o-projeto"><a href="#Instalando-e-Configurando-as-dependencias-para-o-projeto" class="headerlink" title="Instalando e Configurando as dependências para o projeto"></a>Instalando e Configurando as dependências para o projeto</h2><h3 id="Configurando-um-novo-usuario-comum"><a href="#Configurando-um-novo-usuario-comum" class="headerlink" title="Configurando um novo usuário comum"></a>Configurando um novo usuário comum</h3><p>Como pode-se perceber ao acessar nosso novo droplet, o usuário base criado é o root, que possui privilégios muito elevados, sendo fortemente desencorajado a rodar uma aplicação com esse usuário, assim nossa primeira configuração será criar um novo usuário com privilégios menores para rodar nossa aplicação.</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">adduser web</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">Adding user `web<span class="hljs-string">' ...</span></span><br><span class="line"><span class="hljs-string">Adding new group `web'</span> (1000) ...</span><br><span class="line">Adding new user `web<span class="hljs-string">' (1000) with group `web'</span> ...</span><br><span class="line">Creating home directory `/home/web<span class="hljs-string">' ...</span></span><br><span class="line"><span class="hljs-string">Copying files from `/etc/skel'</span> ...</span><br><span class="line">New password:</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: password updated successfully</span><br><span class="line">Changing the user information <span class="hljs-keyword">for</span> web</span><br><span class="line">Enter the new value, or press ENTER <span class="hljs-keyword">for</span> the default</span><br><span class="line">  Full Name []: Web</span><br><span class="line">  Room Number []:</span><br><span class="line">  Work Phone []:</span><br><span class="line">  Home Phone []:</span><br><span class="line">  Other []:</span><br><span class="line">Is the information correct? [Y/n] y</span><br></pre></td></tr></tbody></table></figure>

<p>A nova conta criada agora é um usuário com privilégios básicos, porém em alguns momentos precisaremos fazer algumas tarefas administrativas, caso não queira fazer a troca de usuário sempre que necessário executar essas tarefas, pode-se incluir esse novo usuário no grupo “sudo”, permitindo que o usuário comum tenha acesso a comandos administrativos mediante ao uso do prefixo “sudo”, para isso execute o seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -aG sudo web</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Liberando-acesso-via-ssh-para-o-novo-usuario"><a href="#Liberando-acesso-via-ssh-para-o-novo-usuario" class="headerlink" title="Liberando acesso via ssh para o novo usuário"></a>Liberando acesso via ssh para o novo usuário</h3><p>Caso esteja usando uma chave ssh, como sugerido acima,&nbsp;para acesso ao servidor, será necessário adicionar uma chave autorizada para o usuário também, permitindo que o mesmo consiga logar no sistema. Em sistemas críticos é extremamente importante não usar a mesma chave para ambos os acessos, porém para este exemplo iremos copiar a mesma autorização do usuário root para simplificar o processo.</p>
<figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync --archive --chown=web:web /root/.ssh /home/web</span><br></pre></td></tr></tbody></table></figure>

<p>Com esse comando será copiado os arquivos necessários para acesso, mantendo as permissões adequadas. Agora podemos nos desconectar via root acessando novamente o servidor usando nosso novo usuário com o comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh web@161.35.10.18</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Ativando-e-configurando-algumas-regras-basicas-de-acesso-no-Firewall"><a href="#Ativando-e-configurando-algumas-regras-basicas-de-acesso-no-Firewall" class="headerlink" title="Ativando e configurando algumas regras básicas de acesso no Firewall"></a>Ativando e configurando algumas regras básicas de acesso no Firewall</h3><p>O linux possui muitas ferramentas interessantes e poderosas para manter a integridade do servidor restringindo o acesso ao mínimo necessário, para esse exemplo iremos utilizar um firewall que já vem incluso no ubuntu e que a principio atende bem nossa demanda, visto que simplifica muito a criação e&nbsp;administração das regras de acesso ao servidor usando perfis de aplicação registradas na instalação de alguns softwares. Para visualizar os perfis disponíveis no sistema:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw app list</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">Available applications:</span><br><span class="line">  OpenSSH</span><br></pre></td></tr></tbody></table></figure>

<p>Antes de ativar o firewall, muita atenção para garantir que as conexões via SSH estão habilitadas, para isso execute o seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow OpenSSH</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">Rules updated</span><br><span class="line">Rules updated (v6)</span><br></pre></td></tr></tbody></table></figure>

<p>Depois disso podemos ativar nosso firewall&nbsp;usando seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw <span class="hljs-built_in">enable</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">Command may disrupt existing ssh connections. Proceed with operation (y|n)? y</span><br><span class="line">Firewall is active and enabled on system startup</span><br></pre></td></tr></tbody></table></figure>

<p>Para visualizar as regras ativas no sistema execute o comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">Status: active</span><br><span class="line"></span><br><span class="line">To                         Action      From</span><br><span class="line">--                         ------      ----</span><br><span class="line">OpenSSH                    ALLOW       Anywhere</span><br><span class="line">OpenSSH (v6)               ALLOW       Anywhere (v6)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Instalando-o-NodeJs"><a href="#Instalando-o-NodeJs" class="headerlink" title="Instalando o NodeJs"></a>Instalando o NodeJs</h3><p>Para instalarmos o node iremos usar os repositórios disponibilizados via PPA com os seguintes comandos:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">cd</span> ~</span><br><span class="line">curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -</span><br></pre></td></tr></tbody></table></figure>

<p>Após a conclusão dos comandos acima, estamos aptos agora a proceder com a instalação do node. Repare porém, que no segundo comando eu defino a versão 14, a LTS no momento que escrevo este artigo, porém provavelmente só ajustar a versão mais atual será o suficiente para fazer a instalação da versão correta que precisa para rodar sua aplicação. Para instalar agora o nodejs basta executar o seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nodejs build-essential</span><br></pre></td></tr></tbody></table></figure>

<p>A instalação do pacote “build-essential” é opcional neste exemplo, porém muito provavelmente vai precisar dele no dia a dia no servidor com aplicações node.</p>
<p>Para verificar a instalação podemos executar o seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">v14.17.2</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm -v</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">6.14.13</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Instalando-e-configurando-o-PM2"><a href="#Instalando-e-configurando-o-PM2" class="headerlink" title="Instalando e configurando o PM2"></a>Instalando e configurando o PM2</h3><p>O PM2 é um gerenciador de processos para aplicativos node.js que nos possibilitará gerenciar, escalonar e manter o aplicativos sempre disponível. A instalação do PM2 é muito simples e feita diretamente usando o NPM com o comando abaixo:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install pm2@latest -g</span><br></pre></td></tr></tbody></table></figure>

<p>Para verificar se a instalação foi feita com sucesso use o comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pm2 --version</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">5.1.0</span><br></pre></td></tr></tbody></table></figure>

<p>Agora chegou o momento de obtermos nossa aplicação para seguirmos com a configuração, para simplificar esse artigo removendo complexidades de integrar esse fluxo em um servidor de CI/CD por exemplo, vou apenas simular que já tenho os arquivos no servidor, baixando os mesmos do repositório via GIT com a seguinte sequência de comandos:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">cd</span> ~</span><br><span class="line">git <span class="hljs-built_in">clone</span> -b master https://github.com/meneguite/node-simple-api.git node-simple-api</span><br><span class="line"><span class="hljs-built_in">cd</span> node-simple-api</span><br></pre></td></tr></tbody></table></figure>

<p>Para visualizar os arquivos disponibilizados:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ls -la</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">total 24</span><br><span class="line">drwxrwxr-x 3 web web 4096 Jul 12 22:01 .</span><br><span class="line">drwxr-xr-x 8 web web 4096 Jul 12 22:01 ..</span><br><span class="line">-rw-rw-r-- 1 web web  291 Jul 12 22:01 ecosystem.config.js</span><br><span class="line">drwxrwxr-x 8 web web 4096 Jul 12 22:01 .git</span><br><span class="line">-rw-rw-r-- 1 web web 1627 Jul 12 22:01 index.js</span><br><span class="line">-rw-rw-r-- 1 web web  594 Jul 12 22:01 README.md</span><br></pre></td></tr></tbody></table></figure>

<p>Ps: No droplet criado com ubuntu 20 já temos o git instalado por padrão, porém caso ainda não o tenha, basta executar o seguinte comando “sudo apt install -y git” para instalar.</p>
<p>Com os arquivos em mãos podemos dar inicio a configuração da nossa aplicação no PM2, essa configuração pode ser feita parametrizando o pm2 via linha de comando, porém para simplificar disponibilizei no repositório um arquivo “ecosystem.config.js” que já possui todos os parâmetros necessários para configurar a aplicação. O formato do arquivo ecosystem é o seguinte:</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">module</span>.exports = {</span><br><span class="line">  <span class="hljs-attr">apps</span>: [</span><br><span class="line">    {</span><br><span class="line">      <span class="hljs-attr">name</span>: <span class="hljs-string">'node-simple-api'</span>,</span><br><span class="line">      <span class="hljs-attr">script</span>: <span class="hljs-string">'./index.js'</span>,</span><br><span class="line">      <span class="hljs-attr">instances</span>: <span class="hljs-number">2</span>,</span><br><span class="line">      <span class="hljs-attr">exec_mode</span>: <span class="hljs-string">'cluster'</span>,</span><br><span class="line">      <span class="hljs-attr">merge_logs</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">      <span class="hljs-attr">env_production</span>: {</span><br><span class="line">        <span class="hljs-attr">DEBUG</span>: <span class="hljs-literal">false</span>,</span><br><span class="line">        <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">'production'</span>,</span><br><span class="line">        <span class="hljs-attr">APP_PORT</span>: <span class="hljs-number">3000</span>,</span><br><span class="line">      },</span><br><span class="line">    },</span><br><span class="line">  ],</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>Para iniciarmos nossa aplicação usando esse nosso arquivo e garantir que o mesmo seja iniciado automaticamente sempre que o PM2 iniciar devemos executar o seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pm2 start ecosystem.config.js --env production &amp;&amp; pm2 save</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">[PM2] Applying action restartProcessId on app [node-simple-api](ids: [ 0, 1 ])</span><br><span class="line">[PM2] [node-simple-api](0) ✓</span><br><span class="line">[PM2] [node-simple-api](1) ✓</span><br><span class="line">┌─────┬────────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐</span><br><span class="line">│ id  │ name               │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │</span><br><span class="line">├─────┼────────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤</span><br><span class="line">│ 0   │ node-simple-api    │ default     │ N/A     │ cluster │ 14177    │ 0s     │ 1    │ online    │ 0%       │ 37.8mb   │ web      │ disabled │</span><br><span class="line">│ 1   │ node-simple-api    │ default     │ N/A     │ cluster │ 14189    │ 0s     │ 1    │ online    │ 0%       │ 30.8mb   │ web      │ disabled │</span><br></pre></td></tr></tbody></table></figure>

<p>Assim já temos nossa aplicação rodando na porta 3000 localmente, como podemos verificar abaixo:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:3000/users</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">[{<span class="hljs-string">"id"</span>:1,<span class="hljs-string">"name"</span>:<span class="hljs-string">"Nanna Pedersen"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"nanna.pedersen@example.com"</span>},{<span class="hljs-string">"id"</span>:2,<span class="hljs-string">"name"</span>:<span class="hljs-string">"Sarah Oliver"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"sarah.oliver@example.com"</span>},{<span class="hljs-string">"id"</span>:3,<span class="hljs-string">"name"</span>:<span class="hljs-string">"Hector Guerrero"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"hector.guerrero@example.com"</span>},{<span class="hljs-string">"id"</span>:4,<span class="hljs-string">"name"</span>:<span class="hljs-string">"Noah Poulsen"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"noah.poulsen@example.com"</span>}]</span><br></pre></td></tr></tbody></table></figure>

<p>O PM2 é muito flexível e poderoso, nesse momento já temos disponível nossa aplicação e podemos escalar ela sem nenhuma dificuldade, por exemplo, para subir para 4 o número de instancias disponíveis, podemos executar o comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pm2 scale node-simple-api 4</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">[PM2] Scaling up application</span><br><span class="line">[PM2] Scaling up application</span><br><span class="line">┌─────┬────────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐</span><br><span class="line">│ id  │ name               │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │</span><br><span class="line">├─────┼────────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤</span><br><span class="line">│ 0   │ node-simple-api    │ default     │ N/A     │ cluster │ 14177    │ 4m     │ 1    │ online    │ 0%       │ 39.8mb   │ web      │ disabled │</span><br><span class="line">│ 1   │ node-simple-api    │ default     │ N/A     │ cluster │ 14189    │ 4m     │ 1    │ online    │ 0%       │ 38.6mb   │ web      │ disabled │</span><br><span class="line">│ 2   │ node-simple-api    │ default     │ N/A     │ cluster │ 14238    │ 0s     │ 0    │ online    │ 0%       │ 35.4mb   │ web      │ disabled │</span><br><span class="line">│ 3   │ node-simple-api    │ default     │ N/A     │ cluster │ 14245    │ 0s     │ 0    │ online    │ 0%       │ 30.3mb   │ web      │ disabled │</span><br><span class="line">└─────┴────────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘</span><br></pre></td></tr></tbody></table></figure>

<p>Mais informações e exemplos de uso do PM2 podem ser visualizados na documentação oficial disponível em <a target="_blank" rel="noopener" href="https://pm2.keymetrics.io/docs/usage/quick-start/">https://pm2.keymetrics.io/docs/usage/quick-start/</a></p>
<p>Para configurarmos o PM2 para iniciar junto com o sistema operacional é bem simples, e o próprio PM2 já nos facilita com o comando “pm2 startup”</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pm2 startup</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">[PM2] Init System found: systemd</span><br><span class="line">[PM2] To setup the Startup Script, copy/paste the following <span class="hljs-built_in">command</span>:</span><br><span class="line">sudo env PATH=<span class="hljs-variable">$PATH</span>:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u web --hp /home/web</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">sudo env PATH=<span class="hljs-variable">$PATH</span>:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u web --hp /home/web</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">                        -------------</span><br><span class="line"></span><br><span class="line">__/\\\\\\\\\\\\\____/\\\\____________/\\\\____/\\\\\\\\\_____</span><br><span class="line"> _\/\\\/////////\\\_\/\\\\\\________/\\\\\\__/\\\///////\\\___</span><br><span class="line">  _\/\\\_______\/\\\_\/\\\//\\\____/\\\//\\\_\///______\//\\\__</span><br><span class="line">   _\/\\\\\\\\\\\\\/__\/\\\\///\\\/\\\/_\/\\\___________/\\\/___</span><br><span class="line">    _\/\\\/////////____\/\\\__\///\\\/___\/\\\________/\\\//_____</span><br><span class="line">     _\/\\\_____________\/\\\____\///_____\/\\\_____/\\\//________</span><br><span class="line">      _\/\\\_____________\/\\\_____________\/\\\___/\\\/___________</span><br><span class="line">       _\/\\\_____________\/\\\_____________\/\\\__/\\\\\\\\\\\\\\\_</span><br><span class="line">        _\///______________\///______________\///__\///////////////__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                          Runtime Edition</span><br><span class="line"></span><br><span class="line">        PM2 is a Production Process Manager <span class="hljs-keyword">for</span> Node.js applications</span><br><span class="line">                     with a built-in Load Balancer.</span><br><span class="line"></span><br><span class="line">                Start and Daemonize any application:</span><br><span class="line">                $ pm2 start app.js</span><br><span class="line"></span><br><span class="line">                Load Balance 4 instances of api.js:</span><br><span class="line">                $ pm2 start api.js -i 4</span><br><span class="line"></span><br><span class="line">                Monitor <span class="hljs-keyword">in</span> production:</span><br><span class="line">                $ pm2 monitor</span><br><span class="line"></span><br><span class="line">                Make pm2 auto-boot at server restart:</span><br><span class="line">                $ pm2 startup</span><br><span class="line"></span><br><span class="line">                To go further checkout:</span><br><span class="line">                http://pm2.io/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        -------------</span><br><span class="line"></span><br><span class="line">[PM2] Init System found: systemd</span><br><span class="line">Platform systemd</span><br><span class="line">Template</span><br><span class="line">[Unit]</span><br><span class="line">Description=PM2 process manager</span><br><span class="line">Documentation=https://pm2.keymetrics.io/</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">User=web</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">Environment=PATH=/usr/<span class="hljs-built_in">local</span>/sbin:/usr/<span class="hljs-built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/<span class="hljs-built_in">local</span>/games:/snap/bin:/usr/bin:/bin:/usr/<span class="hljs-built_in">local</span>/sbin:/usr/<span class="hljs-built_in">local</span>/bin:/usr/sbin:/usr/bin</span><br><span class="line">Environment=PM2_HOME=/home/web/.pm2</span><br><span class="line">PIDFile=/home/web/.pm2/pm2.pid</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">ExecStart=/usr/lib/node_modules/pm2/bin/pm2 resurrect</span><br><span class="line">ExecReload=/usr/lib/node_modules/pm2/bin/pm2 reload all</span><br><span class="line">ExecStop=/usr/lib/node_modules/pm2/bin/pm2 <span class="hljs-built_in">kill</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">Target path</span><br><span class="line">/etc/systemd/system/pm2-web.service</span><br><span class="line">Command list</span><br><span class="line">[ <span class="hljs-string">'systemctl enable pm2-web'</span> ]</span><br><span class="line">[PM2] Writing init configuration <span class="hljs-keyword">in</span> /etc/systemd/system/pm2-web.service</span><br><span class="line">[PM2] Making script booting at startup...</span><br><span class="line">[PM2] [-] Executing: systemctl <span class="hljs-built_in">enable</span> pm2-web...</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/pm2-web.service → /etc/systemd/system/pm2-web.service.</span><br><span class="line">[PM2] [v] Command successfully executed.</span><br><span class="line">+---------------------------------------+</span><br><span class="line">[PM2] Freeze a process list on reboot via:</span><br><span class="line">$ pm2 save</span><br><span class="line"></span><br><span class="line">[PM2] Remove init script via:</span><br><span class="line">$ pm2 unstartup systemd</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pm2 save</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">[PM2] Saving current process list...</span><br><span class="line">[PM2] Successfully saved <span class="hljs-keyword">in</span> /home/web/.pm2/dump.pm2</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Instalando-e-configurando-o-nginx-como-proxy-reverso"><a href="#Instalando-e-configurando-o-nginx-como-proxy-reverso" class="headerlink" title="Instalando e configurando o nginx como proxy reverso"></a>Instalando e configurando o nginx como proxy reverso</h3><p>Para instalarmos o nginx via PPA devemos executar os seguintes comandos:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:nginx/stable -y</span><br><span class="line">sudo apt install -y nginx</span><br></pre></td></tr></tbody></table></figure>

<p>Podemos verificar se a instalação foi finalizada com sucesso com o seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx status</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">● nginx.service - A high performance web server and a reverse proxy server</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: active (running) since Tue 2021-07-13 13:56:54 UTC; 18min ago</span><br><span class="line">       Docs: man:nginx(8)</span><br><span class="line">   Main PID: 749 (nginx)</span><br><span class="line">      Tasks: 2 (<span class="hljs-built_in">limit</span>: 1136)</span><br><span class="line">     Memory: 11.0M</span><br><span class="line">     CGroup: /system.slice/nginx.service</span><br><span class="line">             ├─749 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;</span><br><span class="line">             └─752 nginx: worker process</span><br><span class="line"></span><br><span class="line">Jul 13 13:56:53 node-simple-api systemd[1]: Starting A high performance web server and a reverse proxy server...</span><br><span class="line">Jul 13 13:56:54 node-simple-api systemd[1]: Started A high performance web server and a reverse proxy server.</span><br></pre></td></tr></tbody></table></figure>

<p>Tendo isso em mãos vamos iniciar a configuração de um endereço DNS de entrada, para o teste irei usar o endereço “simple-api.meneguite.com”, para isso iremos criar o arquivo “/etc/nginx/sites-available/simple-api.meneguite.com.conf” com o seguinte conteúdo:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">server {</span><br><span class="line">  listen 80 default_server;</span><br><span class="line">  listen [::]:80 default_server;</span><br><span class="line"></span><br><span class="line">  server_tokens off;</span><br><span class="line"></span><br><span class="line">  server_name simple-api.meneguite.com;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment"># Aditional Security Headers</span></span><br><span class="line">  <span class="hljs-comment"># ref: https://developer.mozilla.org/en-US/docs/Security/HTTP_Strict_Transport_Security</span></span><br><span class="line">  add_header Strict-Transport-Security <span class="hljs-string">"max-age=31536000; includeSubDomains"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment"># ref: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options</span></span><br><span class="line">  add_header X-Frame-Options DENY always;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment"># ref: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options</span></span><br><span class="line">  add_header X-Content-Type-Options nosniff always;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment"># ref: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection</span></span><br><span class="line">  add_header X-Xss-Protection <span class="hljs-string">"1; mode=block"</span> always;</span><br><span class="line"></span><br><span class="line">  location / {</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_set_header Host <span class="hljs-variable">$host</span>;</span><br><span class="line">    proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarde <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;</span><br><span class="line">    proxy_set_header X-NginX-Proxy <span class="hljs-literal">true</span>;</span><br><span class="line">    proxy_set_header Upgrade <span class="hljs-variable">$http_upgrade</span>;</span><br><span class="line">    proxy_set_header Connection <span class="hljs-string">"upgrade"</span>;</span><br><span class="line">    proxy_cache_bypass <span class="hljs-variable">$http_upgrade</span>;</span><br><span class="line">    proxy_buffering off;</span><br><span class="line">    proxy_pass  <span class="hljs-string">"http://127.0.0.1:3000"</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Remover o arquivo default de configuração do nginx:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /etc/nginx/sites-enabled/default</span><br></pre></td></tr></tbody></table></figure>

<p>Criar um link simbólico para habilitar o novo arquivo de configuração:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /etc/nginx/sites-available/simple-api.meneguite.com.conf /etc/nginx/sites-enabled/simple-api.meneguite.com.conf</span><br></pre></td></tr></tbody></table></figure>

<p>Para testarmos e verificarmos se os arquivos e configurações estão ok antes de reiniciar os serviços execute o seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx configtest</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line"> * Testing nginx configuration                                                                                                                           [ OK ]</span><br></pre></td></tr></tbody></table></figure>

<p>Tudo certo e configurado podemos fazer o reload do nginx para que o mesmo leia as configurações novamente e ative corretamente os serviços:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx reload</span><br></pre></td></tr></tbody></table></figure>

<p>Se tudo estiver corrido como esperado até aqui, ao executar o comando abaixo já poderemos ver nossa api funcionando já por trás do proxy reverso do nginx.</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1/users</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">[{<span class="hljs-string">"id"</span>:1,<span class="hljs-string">"name"</span>:<span class="hljs-string">"Nanna Pedersen"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"nanna.pedersen@example.com"</span>},{<span class="hljs-string">"id"</span>:2,<span class="hljs-string">"name"</span>:<span class="hljs-string">"Sarah Oliver"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"sarah.oliver@example.com"</span>},{<span class="hljs-string">"id"</span>:3,<span class="hljs-string">"name"</span>:<span class="hljs-string">"Hector Guerrero"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"hector.guerrero@example.com"</span>},{<span class="hljs-string">"id"</span>:4,<span class="hljs-string">"name"</span>:<span class="hljs-string">"Noah Poulsen"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"noah.poulsen@example.com"</span>}]</span><br></pre></td></tr></tbody></table></figure>

<p>Tudo configurado e funcionando, porém se tentar acesso pelo browser receberá a seguinte mensagem:</p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/009.jpg" class="square">

<p>Isso acontece devido a ainda não termos feito a liberação da porta 80 de entrada necessária para acesso ao nginx, para fazer essa liberação devemos proceder com os seguintes comandos:</p>
<p>Verificar os apps disponíveis:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw app list</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">Available applications:</span><br><span class="line">  Nginx Full</span><br><span class="line">  Nginx HTTP</span><br><span class="line">  Nginx HTTPS</span><br><span class="line">  OpenSSH</span><br></pre></td></tr></tbody></table></figure>

<p>No nosso exemplo não configuramos os certificados para usarmos o https, assim vamos por hora liberar acesso apenas a porta http do ngix com o seguinte comando:</p>
<figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="hljs-string">'Nginx HTTP'</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Output</span></span><br><span class="line">Rule added</span><br><span class="line">Rule added (v6)</span><br></pre></td></tr></tbody></table></figure>

<p>E enfim temos nosso serviço instalado e configurado:</p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/010.jpg" class="">

<p>Nosso servidor está acessível externamente e com a aplicação clousterizada usando o PM2, porém não é tão legal acessar nosso serviço sem um https, muito menos pelo ip, para resolver isso podemos usar o serviço da cloudflare para nos prover um certificado https válido, este processo é bem simples e descrevo como fazer no artigo “Publicar um site com Github Pages e CloudFlare” acessível no endereço: <a href="https://meneguite.com/2018/11/10/publicar-um-site-com-github-pages-e-cloudflare">https://meneguite.com/2018/11/10/publicar-um-site-com-github-pages-e-cloudflare</a></p>
<img src="/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/011.jpg" class="">

<p>Tudo pronto agora! Para o escopo deste artigo chegamos ao final, mas claro, sabemos que muitas outras necessidades vem ao criar uma aplicação, com essa configuração básica já consegue iniciar e validar pontos iniciais com um custo muito baixo, porém durante a trajetória provavelmente vai sentir a necessidade de um banco de dados, relacional ou não, e pode lançar outros droplets para resolver esta demanda, ou pode optar por usar um serviço disponibilizado pela própria Digital Ocean o “Managed Databases”, com esse serviço terceiriza toda a complexidade inicial de configurar e manter um servidor de banco de dados, para mais informações acesse “<a target="_blank" rel="noopener" href="https://www.digitalocean.com/products/managed-databases/?refcode=2e1c3d77e32b">https://www.digitalocean.com/products/managed-databases/</a>“.  Outra demanda que muito provavelmente precisará em breve é trabalhar na resiliência da aplicação, ainda que muito estável, os servidores ou o próprio droplet pode parar de funcionar em algum momento, ou mesmo sua aplicação pode crescer e somente um único servidor deixar de ser suficiente, assim uma boa estratégia será incluir no meio do caminho um servidor de load balancer, serviço provido pela própria digital ocean, e lançar duas ou mais instancias do droplet que configuramos neste artigo, assim mesmo que tenha uma demanda maior ou um dos droplets tenha algum problema, nosso serviço continua a funcionar normalmente.</p>
<p>Os códigos usados neste artigo estão disponíveis no repositório <a target="_blank" rel="noopener" href="https://github.com/meneguite/node-simple-api.git">https://github.com/meneguite/node-simple-api.git</a>, qualquer dúvida ou sugestão de melhora fique a vontade para deixar aqui abaixo nos comentários.</p>
</body></html>
        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link-link" href="/tags/Backend/" rel="tag">Backend</a>, <a class="has-link-grey -link-link" href="/tags/Cloudflare/" rel="tag">Cloudflare</a>, <a class="has-link-grey -link-link" href="/tags/Digital-Ocean/" rel="tag">Digital Ocean</a>, <a class="has-link-grey -link-link" href="/tags/Node/" rel="tag">Node</a>
                </div>
            </div>
        </div>
        
        
        
        
<div class="addthis_inline_share_toolbox"></div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5be9af6fb1e18cc9"></script>

        
    </div>
</div>


<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2021/07/05/principais-comandos-do-npm/">
                <span class="level-item">Principais comandos do NPM</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comentários</h3>
        <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.8";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-comments" data-width="100%" data-href="https://meneguite.com/2021/07/13/publicando-uma-aplicacao-nodejs-na-digital-ocean/" data-num-posts="5"></div>


    </div>
</div>
</div>
                



<div class="column is-4-tablet is-3-desktop is-3-widescreen  has-order-1 column-left">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    <img class="image is-128x128 has-mb-6 is-rounded" src="https://avatars0.githubusercontent.com/u/8209481" alt="avatar">
                    
                    <p class="is-size-4 is-block">
                        Ronaldo Meneguite
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Just another tech enthusiast
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Brasil</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        
        
            <div class="level is-mobile">
                
                <a class="level-item button is-white is-marginless" target="_blank"
                   title="Github" href="http://github.com/meneguite">
                    
                        <i class="fab fa-github fa-2x"></i>
                    
                </a>
                
                <a class="level-item button is-white is-marginless" target="_blank"
                   title="Linkedin" href="https://www.linkedin.com/in/ronaldomeneguite">
                    
                        <i class="fab fa-linkedin fa-2x"></i>
                    
                </a>
                
                <a class="level-item button is-white is-marginless" target="_blank"
                   title="Facebook" href="https://www.facebook.com/ronaldomeneguite">
                    
                        <i class="fab fa-facebook fa-2x"></i>
                    
                </a>
                
            </div>
        
        <hr />
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Artigos
                    </p>
                    <p class="title has-text-weight-normal">
                        19
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categorias
                    </p>
                    <p class="title has-text-weight-normal">
                        7
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        32
                    </p>
                </div>
            </div>
        </nav>

    </div>
</div>
    
        
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categorias
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Desenvolvimento/">
            <span class="level-start">
                <span class="level-item">Desenvolvimento</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">9</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Desenvolvimento/Backend/">
            <span class="level-start">
                <span class="level-item">Backend</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Desenvolvimento/Frontend/">
            <span class="level-start">
                <span class="level-item">Frontend</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Infraestrutura/">
            <span class="level-start">
                <span class="level-item">Infraestrutura</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">10</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Infraestrutura/Desenvolvimento/">
            <span class="level-start">
                <span class="level-item">Desenvolvimento</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Infraestrutura/Seguranca/">
            <span class="level-start">
                <span class="level-item">Segurança</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <ul class="menu-list">
                
                <li>
                    <a class="level is-marginless" href="/tags/Adapter-Pattern/">
                        <span class="level-start">
                            <span class="level-item">Adapter Pattern</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Aplicativos/">
                        <span class="level-start">
                            <span class="level-item">Aplicativos</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Autenticacao-Centralizada/">
                        <span class="level-start">
                            <span class="level-item">Autenticação Centralizada</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Backend/">
                        <span class="level-start">
                            <span class="level-item">Backend</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">6</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Banco-de-Dados/">
                        <span class="level-start">
                            <span class="level-item">Banco de Dados</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Cloudflare/">
                        <span class="level-start">
                            <span class="level-item">Cloudflare</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Deno/">
                        <span class="level-start">
                            <span class="level-item">Deno</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Design-Patterns/">
                        <span class="level-start">
                            <span class="level-item">Design Patterns</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Digital-Ocean/">
                        <span class="level-start">
                            <span class="level-item">Digital Ocean</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Frontend/">
                        <span class="level-start">
                            <span class="level-item">Frontend</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Github-Pages/">
                        <span class="level-start">
                            <span class="level-item">Github Pages</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Golang/">
                        <span class="level-start">
                            <span class="level-item">Golang</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">3</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Infraestrutura/">
                        <span class="level-start">
                            <span class="level-item">Infraestrutura</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">4</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/LDAP/">
                        <span class="level-start">
                            <span class="level-item">LDAP</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Ldap/">
                        <span class="level-start">
                            <span class="level-item">Ldap</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Linux/">
                        <span class="level-start">
                            <span class="level-item">Linux</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">3</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/MongoDb/">
                        <span class="level-start">
                            <span class="level-item">MongoDb</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/NoSql/">
                        <span class="level-start">
                            <span class="level-item">NoSql</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Node/">
                        <span class="level-start">
                            <span class="level-item">Node</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Npm/">
                        <span class="level-start">
                            <span class="level-item">Npm</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/OAuth/">
                        <span class="level-start">
                            <span class="level-item">OAuth</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/OAuth-2/">
                        <span class="level-start">
                            <span class="level-item">OAuth 2</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Observer-Pattern/">
                        <span class="level-start">
                            <span class="level-item">Observer Pattern</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/OpenLdap/">
                        <span class="level-start">
                            <span class="level-item">OpenLdap</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/PWA/">
                        <span class="level-start">
                            <span class="level-item">PWA</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Padroes-de-Projeto/">
                        <span class="level-start">
                            <span class="level-item">Padrões de Projeto</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Programacao/">
                        <span class="level-start">
                            <span class="level-item">Programação</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">4</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Progressive-Web-Apps/">
                        <span class="level-start">
                            <span class="level-item">Progressive Web Apps</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Slack/">
                        <span class="level-start">
                            <span class="level-item">Slack</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Tutoriais/">
                        <span class="level-start">
                            <span class="level-item">Tutoriais</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Typescript/">
                        <span class="level-start">
                            <span class="level-item">Typescript</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">2</span>
                        </span>
                    </a>
                </li>
                
                <li>
                    <a class="level is-marginless" href="/tags/Utilitario/">
                        <span class="level-start">
                            <span class="level-item">Utilitario</span>
                        </span>
                        <span class="level-end">
                            <span class="level-item tag">1</span>
                        </span>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="card card-transparent is-hidden-desktop is-hidden-widescreen">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
	<div class="container">
		<div class="level">
			<div class="level-start has-text-centered-mobile">
				<!-- <a class="footer-logo is-block has-mb-6" href="/">
					
					<img src="/images/logo.svg" alt="" height="28">
					
				</a> -->
				<p class="is-size-7">
					&copy; 2021 Ronaldo Meneguite&nbsp;
				</p>
			</div>
			<div class="level-end">
				
				<div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
					
					
					<span class="control">
						<a class="button is-white is-large" target="_blank"
							title="Creative Commons" href="https://creativecommons.org/">
							
							<i class="fab fa-creative-commons fa-2x"></i>
							
						</a>
					</span>
					
					<span class="control">
						<a class="button is-white is-large" target="_blank"
							title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
							
							<i class="fab fa-creative-commons-by fa-2x"></i>
							
						</a>
					</span>
					
				</div>
				
			</div>
		</div>
	</div>
</footer>
    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>

<script>moment.locale("pt-BR");</script>


    
    
    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js"></script>

    
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

    <script>
        (function ($) {
            $(document).ready(function () {
                if (typeof($.fn.lightGallery) === 'function') {
                    $('.article').lightGallery({ selector: '.gallery-item' });
                }
                if (typeof($.fn.justifiedGallery) === 'function') {
                    $('.justified-gallery').justifiedGallery();
                }
            });
        })(jQuery);
    </script>
    

    
    
    
    <div id="outdated">
        <h6>Your browser is out-of-date!</h6>
        <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
        <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
    </div>
    
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js"></script>

    <script>
        $(document).ready(function () {
            // plugin function, place inside DOM ready function
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'flex'
            })
        });
    </script>
    

    
    
    
    
<script src="https://cdn.jsdelivr.net/npm/animejs@2.2.0/anime.js"></script>

    <script>
    function isIE() {
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf('MSIE ');
        var trident = ua.indexOf('Trident/');
        return (msie > 0 || trident > 0);
    }

    $(document).ready(function () {
        $('body>.navbar,body>.section,body>.footer').css('opacity', 1);
        if (!isIE()) {
            ['.column-main > .card',
             '.column-left > .card',
             '.column-right > .card'].map(function(target) {
                anime({
                    targets: target,
                    scale: [0.8, 1],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutSine',
                    delay: function(el, i, l) {
                        return i * 100;
                    }
                })
            });

            anime({
                targets: '.navbar-main',
                translateY: [-100, 0],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutSine'
            });
        }
    });
    </script>
    

    
    
    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<style>
#back-to-top {
    position: fixed;
    padding: 8px 0;
    transition: 0.4s ease opacity, 0.4s ease width, 0.4s ease transform, 0.4s ease border-radius;
    opacity: 0;
    line-height: 24px;
    outline: none;
    transform: translateY(120px);
}
#back-to-top.fade-in {
    opacity: 1;
}
#back-to-top.rise-up {
    transform: translateY(0);
}
</style>

<script src="/js/back-to-top.js"></script>



    
    

    
    
    



<script src="/js/main.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Digite alguma coisa..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Artigos',
                PAGES: 'Páginas',
                CATEGORIES: 'Categorias',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>


<link rel="stylesheet" href="/css/search.css">


<link rel="stylesheet" href="/css/insight.css">

    
</body>
</html>